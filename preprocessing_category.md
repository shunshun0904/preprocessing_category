## 前処理シリーズ3

ここからはカテゴリ特徴量の扱い方を述べていきます。この特徴量の扱い方を学ぶことで、SVMやランダムフォレストなどの特徴量に強く依存する分類器の深い理解にも繋がります。



### カテゴリカルデータの概要

グループで分類される変数をもつデータです。グループでの分類というのが「ミソ」です。
具体的に言うと、データサイエンティストが扱うデータは個数や人数のように数えられるものだけではありません。顧客満足度や好みのように，数えることのできないデータも存在します。それらのデータがカテゴリカルデータです。定性的データと言うとイメージがつくかもしれません。

<img width="400" alt="2017-10-20 15 30 51" src="https://user-images.githubusercontent.com/25298659/31848550-0f4259b8-b670-11e7-9a28-037b3df29fb8.png">




カテゴリカルデータがどんなデータか理解したところで、具体的にどんな処理方法があるのか見ていきましょう。

### ワンホットエンコーディング
カテゴリカルデータを処理する方法として一番よく用いられるのがこの手法です。得られた特徴量（性別や年齢）を「0と1」のデータに置き換えるものです。0と1に置き換えることで、SVMやナイーブベイズ等の線形2クラス分類の式が適用できるのでsckit-learnのほとんどのライブラリを使用することができるようになります。

<img width="400" alt="2017-10-20 15 30 51" src="https://user-images.githubusercontent.com/25298659/31808914-557bd0aa-b5b0-11e7-8c43-5a01b04211fc.png">





具体例として以下のようなものを見ましょう。

```
import pandas

df = pandas.DataFrame([
        ['本田', 'L', 400, 'class1'],
        ['香川', 'S', 450, 'class2'],
        ['岡崎', 'M', 200, 'class1']])
df.columns = ['name', 'size', 'salary', 'classlabel']
df

```

<img width="229" alt="2017-10-20 17 49 53" src="https://user-images.githubusercontent.com/25298659/31812862-55d5452c-b5bf-11e7-9d44-df00b35fc721.png">



#### 小課題1
調べて構いませんので、以下のようにpandasデータフレームが出力されるようにコードを作成してみてください。

######ヒント:get_dummiesメソッドを用います。

<img width="448" alt="2017-10-20 17 49 58" src="https://user-images.githubusercontent.com/25298659/31812858-53e20476-b5bf-11e7-9a45-4c3879b7b968.png">

#### 小課題1 解答
```
pandas.get_dummies(df[['salary', 'name', 'size']])

```

こうすることで、縦の列で見た時に、そのカテゴリーに含まれるものなら1それ以外は0になっています。ここで、「name_" "」や「size_" "」はダミー変数と呼ばれるものです。つまり各データポイントに対して、ダミー変数は縦の列で見た時に一つだけ、1になります。これが、「ワンホットエンコーディング」と呼ばれる理由です。


### 名義尺度
名義尺度とは分類の順序に意味がないものです。電話番号、性別、血液型などのただのラベルです。「A型よりB型が大きい」とか、「A型はB型より点数が高い！」とか使い方はしませんよね。

### 順序尺度
上述した名義尺度とは別で、分類の尺度に意味があるものです。アンケートで「1:良い、2:普通、3:悪い」というのは、順序に意味があるわけです。2よりも1の方が優れているわけです。そしてこういったものは定量的に扱うこともできません。

「あの店の料理は、この店の料理の3倍美味しい」とは言いませんよね。なのでこの順序尺度もカテゴリカルデータに入ります。


試しに、順序尺度と名義尺度をエンコーディングしていきましょう。

#### 小課題2
以下のようにpandasデータフレームが出力されるように、実装して見てください。

##### ヒント：mapメソッドを用います。

<img width="236" alt="2017-10-21 14 28 16" src="https://user-images.githubusercontent.com/25298659/31848390-cf189c2e-b66c-11e7-8a32-1d91c02aede3.png">

#### 小課題2 解答

```
size_mapping = {'L': 1, 'S': 2, 'M': 3}
df['size'] = df['size'].map(size_mapping)
df

```

#### 小課題3
次に名義尺度をエンコーディングしましょう。
以下のようにpandasデータフレームが出力されるように、実装して見てください。

##### ヒント：enumerate関数を使うと良い感じにできます。（mapメソッドも用います。）

<img width="231" alt="2017-10-21 14 28 26" src="https://user-images.githubusercontent.com/25298659/31848364-312a8130-b66c-11e7-89e8-2bd73df2a854.png">


#### 小課題3 解答

```
class_mapping = {l:i for i, l in enumerate(numpy.unique(df['classlabel']))}
class_mapping
df['classlabel'] = df['classlabel'].map(class_mapping)
df
```
